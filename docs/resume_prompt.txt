
---

```txt
# docs/resume_prompt.txt

This prompt was generated by you for continuation of previous work in a new thread. 

We  continue now in this new thread on my HomeAssistant Skolmat integration. 
Begin with re-familiarize yourself with current release (2.0) at kaptensanders/skolmat, gihub. 
We will work on the 2.1 changes that I have locally. Just make sure you understand the purpose and structure of the repo version 2.0.

Now for the new stuff:

You are helping design the filtering/summary selection logic for a Home Assistant custom integration named "skolmat" (v2.1+).

You MUST treat the following as authoritative and locked:
1) The contents of docs/filtering-design-checkpoint.md (pasted below or confirmed in-repo).
2) The canonical Use Case catalog JSON (UC JSON) in real MenuEntry shape (pasted below). This UC JSON is ground truth derived from real log data.

Your job is to continue the design thread WITHOUT reopening locked decisions unless explicitly requested. You should preserve the same level of rigor, skepticism, and insight as previously, and challenge assumptions constructively.

Key locked decisions you must not change unless asked:
- Only two user modes: auto and custom. No "all" mode.
- Processor is last resort; most users should succeed using custom meal selection + filters.
- Summary selection pipeline is Phase A (meal focus) → Phase B (exclusions then ranking) → Phase C (N max cap).
- Exclusions are progressive guarded: apply per-rule only if it leaves at least one entry; otherwise skip the rule and log.
- Preferences only rank; they never remove entries. Deterministic tie-break is original order.
- N is a max, not a target; never fill by crossing meals.
- Never output empty if input is non-empty; never unintentionally mix meals; deterministic behavior; clear logging.
- Calendar history: do not rewrite past summaries; changes apply from today and forward.
- Full menu is always available via sensor attributes and calendar event description; summary/state is opinionated and short.

When resuming:
- First, restate (briefly) the current phase we’re working on (Phase A auto heuristics, Phase C selection formatting, or HA config flow UX).
- Then, proceed step-by-step and validate reasoning against the UC JSON.
- Do not propose unnecessary complexity; prefer simple, predictable rules that degrade gracefully.
- If a rule could mislead the user (e.g., mixing Lunch and Middag to satisfy N), reject it.

Now continue from where we left off:
- We have locked Phase B behavior (exclusions + ranking).
- We removed "all" mode.
- Next phase to design: (USER WILL SPECIFY: Phase A auto heuristics OR Phase C N selection semantics OR HA config flow UX wiring).
Wait for user to specify which phase to continue if not already stated, but if they say "continue", default to Phase A auto heuristics and validate against UC JSON.

Just update your memory and understanding with this information.

In next two prompts I will post the contents of docs/filtering-design-checkpoint.md
and then the canonical UC JSON usecase.json. Dont generate anything until I finished posting.

